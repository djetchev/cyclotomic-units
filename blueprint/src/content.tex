% In this file you should put the actual content of the blueprint.
% It will be used both by the web and the print version.
% It should *not* include the \begin{document}
%
% If you want to split the blueprint content into several files then
% the current file can be a simple sequence of \input. Otherwise It
% can start with a \section or \chapter for instance.

\chapter{Introduction}
This is my first experimental mini-project 
to formalize the theory of cyclotomic units in Lean. 

\chapter{Regulators of Number Fields}
This chapter presents basic definitions and results on regulators of number fields.

Let $L$ be a number field with $r_1$ real and $r_2$ complex embeddings and let $r = r_1 + r_2 - 1$. 

\section{Definition of the regulator}\label{sec:regulator}

Let $\epsilon_1, \dots, \epsilon_r$ be a set of independent units of $L$. 

\begin{definition}\label{defn:mixed_embeddings}
    \uses{NumberField.mixedEmbedding}
    Let $\sigma_1, \dots, \sigma_{r_1}$ 
    be the set of real embeddings and let $(\sigma_{r_1 + 1}, \overline{\sigma}_{r_1 + 1}), \dots, (\sigma_{r}, \overline{\sigma}_{r})$ be the 
    pairs of conjugate complex embeddings.
\end{definition}

\begin{definition}\label{defn:regulator}
    \notready
    \uses{defn:mixed_embeddings}
    We define the regulator of the units $\epsilon_1, \dots, \epsilon_r$ of $L$ as 
    $$
    R_L(\epsilon_1, \dots, \epsilon_r) := \sqrt{\det(\delta_{i} \log | \sigma_i(\epsilon_j) | )_{i, j}}, 
    $$
    where 
    $$
    \delta_i = 
    \begin{cases}
    1 & \text{ if } \sigma_i \text{ is real}, \\
    2 & \text{ if } \sigma_i \text{ is complex}.
    \end{cases}
    $$
\end{definition}

\section{The index of units subgroups and regulators}

\begin{lemma}\label{lem:index_eq_reg_ratio}
    \uses{defn:regulator}
    Let $\epsilon_1, \dots, \epsilon_r$ be independent units of a number field $K$ that generate a subgroup 
    $A$ of the units of $K$ modulo roots of unity and let $\eta_1, \dots, \eta_r$ generate a subgroup 
    $B$. If $A \subseteq B$ is of finite index then 
    $$
        [B : A] = \frac{R_K(\epsilon_1, \dots, \epsilon_r)}{R_K(\eta_1, \dots, \eta_r)}.
    $$
\end{lemma}

We derive the lemma from the definition of the regulator and the theory of elementary divisors for 
$\mathbb{Z}$-modules.

\begin{lemma}[Smith normal form]\label{lem:elem_divisors}
    \lean{Basis.SmithNormalForm}
    \leanok
    Let $M \in \GL_{n \times m}(\mathbb{Z})$ be an integer matrix. 
    There exists matrices $U \in \GL_n(\mathbb{Z})$ and 
    $V \in \GL_m(\mathbb{Z})$ such that 
    $$
    U M V = 
    \begin{pmatrix}
        D & 0 \\
        0 & 0 
    \end{pmatrix}
    $$ 
    where $D = \textrm{diag}(d_1, \dots, d_r)$ is an $r \times r$ 
    diagonal integer matrix with $d_1 \mid d_2 \mid \dots \mid d_r$.  
\end{lemma}

\begin{proof}
    \proves{lem:elem_divisors}
    \lean{Basis.SmithNormalForm}
    \leanok
\end{proof}

\begin{proof}
    \uses{lem:elem_divisors}
    \proves{lem:index_eq_reg_ratio}
    Since $A \subseteq B$, one can write 
    $$
    \eta_i = \epsilon_1^{a_{i1}} \cdot \dots \cdot \epsilon_r^{a_{i r}} \cdot \mu^{(i)}, \quad i = 1, \dots, r, 
    $$
    where $a_{ij} \in \mathbb{Z}$ and $\mu^{(i)}$ is a root of unity. By taking absolute values and logarithms, 
    $$
    \delta_j \log | \sigma_j(\eta_i) | = \sum_{k = 1}^r a_{ik} \delta_j \log | \sigma_j(\epsilon_k) |, \quad i = 1, \dots, r. 
    $$
    Therefore, using Defintiion~\ref{defn:regulator}, we have
    \begin{equation}\label{eq:reg_ratio}
    \frac{R_K(\epsilon_1, \dots, \epsilon_r)}{R_K(\eta_1, \dots, \eta_r)} = \det ((a_{ik})_{i, k = 1}^r)
    \end{equation}
    Applying Lemma~\ref{lem:elem_divisors}, we can find matrices $U, V \in \GL_2(\mathbb{Z})$ such that 
    $$
    U (a_{ik})_{i, k = 1}^r V = \text{diag}(d_1, \dots, d_r). 
    $$
    Therefore, changing the basis of $A$ and $B$ with $M$ and $N$, respectively, we obtain bases 
    $x_1, \dots, x_r$ of $A$ and $y_1, \dots, y_r$ of $B$ such that $x_i = d_i y_i$, i.e., 
    $$
    B / A = \bigoplus_{i = 1}^r \mathbb{Z} / d_i \mathbb{Z}. 
    $$
    Hence, $[B : A] = |\prod_{i = 1}^r d_i | = \det ((a_{ik})_{i, k = 1}^r)$ which, combined with \eqref{eq:reg_ratio}, 
    proves the lemma.  
\end{proof}


\chapter{The Index of Cyclotomic Units}

\section{Maximal real subfield}
\begin{definition}\label{defn:K_plus}
    Let $K = \mathbb{Q}(\zeta_n)$ where $\zeta_n$ is a primitive $n$-th root of unit. 
    Define the subfield $K^+ := \mathbb{Q}(\zeta_n + \zeta_n^{-1})$ of $K$.
\end{definition}

\begin{lemma}\label{lem:K_plus_max_real_sub}
    \uses{defn:K_plus}
    The subfield $K^+$ is the maximal real subfield of $K$.
\end{lemma}

\begin{proof}
\end{proof}

\section{Cyclotomic units}
\begin{definition}\label{defn:cyclo_units}
    Define the cyclotomic units of a cyclotomic field $K = \mathbb{Q}(\zeta_n)$ with ring of integers 
    $O_K = \mathbb{Z}[\zeta_n]$ as the group 
    $$
    C_K := O_K^\times \cap \langle \zeta_n^a, 1 - \zeta_n^b \colon a, b \in \mathbb{Z} / n \mathbb{Z}\rangle. 
    $$
\end{definition}

\section{Index theorem}
\begin{theorem}\label{thm:index_of_units}
    \notready
    \uses{defn:cyclo_units}
    Let $n := p^m \in \mathbb{N}$ for a prime $p$ and a positive integer $m$, and let $K = \mathbb{Q}(\zeta_n)$ where $\zeta_n$ is a primitive $n$-th root of unit. 
    Let $O_K$ be the ring of integers of $K$. 
    Let $C_K$ be the group of cyclotomic units in $K$ according to Definition~\ref{defn:cyclo-units}.
    Then
    \[
        [O_{K^+}^\times : C_{K^+}] = h_{K^+},
    \]
    where $h_{K^+}$ is the class number of the maximal real subfield $K^+$ of $K$.
\end{theorem}

\begin{proof}
    \proves{thm:K_plus}
    \uses{lem:reg_Ra}
    \begin{itemize}
        \item Show that the regulator of the units $\zeta(a)$ is non-zero, where 
        $$
        \zeta(a) := \zeta_{p^m}^{(1-a)/2} \frac{1 - \zeta_{p^m}^a}{1 - \zeta_{p^m}}, \qquad 1 < a < p^m / 2, \ (a, p) = 1.
        $$
        \item Compute the regulator $R(\{\zeta(a)\})$. 
    \end{itemize}
\end{proof}

\subsection{Computing the regulator for $K^+$}

\begin{lemma}\label{lem:reg_Ra}
    \uses{defn:regulator, defn:K_plus}
    We have
    $$
    R(\{\zeta(a)\}) = h^+ R^+, 
    $$
    where $R^+$ is the regulator of $K^+$.
\end{lemma}

\begin{proof}
    \proves{lem:reg_Ra}
\end{proof}

